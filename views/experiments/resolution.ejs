<% include ../partials/depth-bootup %>

<script>

  //Move the camera slightly backwards
  glScene.camera.position.z += 1.5;

  const vimeo = new Sandbox.VimeoClient();

  // We will store all the character instance in here so we can hit play (kind of) together
  let characters = [];

  vimeo.requestVideo('<%= video_id || 279527916 %>').then(response => {
    // Manually loop through all the progressive video files
    for (let res in vimeo.files.progressive) {

      // Correct the texture sizes based on the current resolution
      response.props.textureWidth = vimeo.files.progressive[res].width;
      response.props.textureHeight = vimeo.files.progressive[res].height;

      player = new Sandbox.DepthPlayer();
      let character = player.loadVideo(response.props,
                                       vimeo.files.progressive[res].link,
                                       'progressive',
                                       response.type);
      let recenteredX = res - 2.5;

      // Create a text that shows the resolution for each take loaded
      const simpleMat = new THREE.MeshPhongMaterial();
      const textResolution = new THREE.TextGeometry(`${vimeo.files.progressive[res].width}x${vimeo.files.progressive[res].height}`, {
        font: glScene.font,
        size: 80,
        height: 5,
        curveSegments: 12,
        bevelEnabled: true,
        bevelThickness: 5,
        bevelSize: 8,
        bevelSegments: 5
      });

      const textMesh = new THREE.Mesh(textResolution, simpleMat);
      textMesh.scale.set(0.001, 0.001, 0.001);
      textMesh.position.set(recenteredX - 0.3, 1.2, -0.5);

      //Position and rotation adjustments
      character.position.x = recenteredX;
      character.position.z = 0.5;
      character.position.y = 0.5;
      character.rotation.y = -Math.PI;
      character.rotation.z = Math.PI / 2;

      //Set to loop and hit play ðŸŽ¬
      character.player.setLoop(true);
      characters.push(character);

      glScene.scene.add(character);
      glScene.scene.add(textMesh);
    }
  });
</script>
